This the smart sort's code.
