This is smart sort's code.
